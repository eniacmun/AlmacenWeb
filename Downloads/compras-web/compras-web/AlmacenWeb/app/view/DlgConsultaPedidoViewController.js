/*
 * File: app/view/DlgConsultaPedidoViewController.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('almacen.view.DlgConsultaPedidoViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.dlgconsultapedido',

    onGridProductosAfterRender: function(component, eOpts) {
        var rec = window.currentPedido.pedidos[0];
        component.getStore().loadData(rec.productos);

        Ext.ComponentMgr.get("btnCancelaPedido").setDisabled(true);
        Ext.ComponentMgr.get("btnRecibePedido").setDisabled(true);
        Ext.ComponentMgr.get("btnFinalizaPedido").setDisabled(true);


        Ext.ComponentMgr.get("btnCancelaPedido").currentRecord=null;
        Ext.ComponentMgr.get("btnCancelaPedido").currentRecord=null;
        Ext.ComponentMgr.get("btnFinalizaPedido").currentRecord=null;



        var estado = parseInt(rec.Claveestado, 10);
        var claveSucursalOrigen = parseInt(rec.claveSucursal, 10);
        var claveSucursalDestino = parseInt(rec.claveCedi, 10);

        if   (estado == 0) {
            Ext.ComponentMgr.get("btnCancelaPedido").setDisabled(false);//habilitamos el boton para cancelar
            Ext.ComponentMgr.get("btnCancelaPedido").currentRecord=rec;
        }
        if   (estado == 1) {
            Ext.ComponentMgr.get("btnCancelaPedido").setDisabled(false);//habilitamos el boton para cancelar en caso de estado aprobado
            Ext.ComponentMgr.get("btnCancelaPedido").currentRecord=rec;
        }
        if (almacen.getApplication().currentSession.claveSucursal==claveSucursalOrigen && estado==1){
            Ext.ComponentMgr.get("btnRecibePedido").setDisabled(false);//habilitamos el boton para recibir
            Ext.ComponentMgr.get("btnRecibePedido").currentRecord=rec;
        }
        if (almacen.getApplication().currentSession.claveSucursal==claveSucursalDestino && estado==2){
            Ext.ComponentMgr.get("btnFinalizaPedido").setDisabled(false);//habilitamos el boton para finalizar
            Ext.ComponentMgr.get("btnFinalizaPedido").currentRecord=rec;
        }
    },

    onGridPedidoAfterRender: function(component, eOpts) {
        var rec = window.currentPedido.pedidos[0];

        //component.getStore().load(rec.productos);
        var arr = [];
        arr.push({"label":"Sucursal", "value":rec.SucursalOrigen});
        arr.push({"label":"Cedi", "value":rec.SucursalDestino});
        arr.push({"label":"Numero", "value":rec.clavePedido});
        arr.push({"label":"Estado", "value":rec.Estado});
        arr.push({"label":"Total", "value":rec.Total});
        arr.push({"label":"Fecha de Registro", "value":rec.fechaRegistro});
        arr.push({"label":"Fecha de Aprobación", "value":rec.fechaRecepcion});
        arr.push({"label":"Fecha de Recepción", "value":rec.fechaConfirmacion});
        arr.push({"label":"Fecha de Finalización", "value":rec.fechaFinalizacion});
        arr.push({"label":"Registrado Por", "value":rec.quienRegistra});
        arr.push({"label":"Cancelado Por", "value":rec.quienCancela});
        arr.push({"label":"Aprobado Por", "value":rec.quienRecibe});
        arr.push({"label":"Recibido Por", "value":rec.quienConfirma});
        arr.push({"label":"Finalizado Por", "value":rec.quienFinaliza});
        component.getStore().loadData(arr);


    },

    CallCancelaPedido: function(button, e, eOpts) {
        var controller =  Ext.WindowMgr.get("wndDetallePedidos").parentController;
        controller.CancelaTraspaso({"currentRecord":window.currentPedido.pedidos[0]},null,null);
    },

    RecibePedido: function(button, e, eOpts) {
        var controller =  Ext.WindowMgr.get("wndDetallePedidos").parentController;
        controller.RecibeTraspaso({"currentRecord":window.currentPedido.pedidos[0]},null,{wnd:Ext.WindowMgr.get("wndDetallePedidos")});

    },

    FinalizaPedido: function(button, e, eOpts) {
        var controller =  Ext.WindowMgr.get("wndDetallePedidos").parentController;
        controller.FinalizaTraspasos({"currentRecord":window.currentPedido.pedidos[0]},null,null);
    }

});
