/*
 * File: app/view/DlgConsultaPedidoViewController1.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('almacen.view.DlgConsultaPedidoViewController1', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.dlgconsultatraspaso',

    onGridProductosAfterRender: function(component, eOpts) {
        var rec = window.currentPedido.traspasos[0];
        component.getStore().loadData(rec.productos);

        Ext.ComponentMgr.get("btnCancelaPedido1").setDisabled(true);
        Ext.ComponentMgr.get("btnRecibePedido1").setDisabled(true);
        Ext.ComponentMgr.get("btnFinalizaPedido1").setDisabled(true);


        Ext.ComponentMgr.get("btnCancelaPedido1").currentRecord=null;
        Ext.ComponentMgr.get("btnCancelaPedido1").currentRecord=null;
        Ext.ComponentMgr.get("btnFinalizaPedido1").currentRecord=null;



        var estado = parseInt(rec.claveEstado, 10);
        var claveSucursalOrigen = parseInt(rec.ClaveSucursalOrigen, 10);
        var claveSucursalDestino = parseInt(rec.ClaveSucursalDestino, 10);

        if   (estado == 0) {
            Ext.ComponentMgr.get("btnCancelaPedido1").setDisabled(false);//habilitamos el boton para cancelar
            Ext.ComponentMgr.get("btnCancelaPedido1").currentRecord=rec;
        }
        if (almacen.getApplication().currentSession.claveSucursal==claveSucursalDestino && estado==0){
            Ext.ComponentMgr.get("btnRecibePedido1").setDisabled(false);//habilitamos el boton para recibir
            Ext.ComponentMgr.get("btnRecibePedido1").currentRecord=rec;
        }
        if (almacen.getApplication().currentSession.claveSucursal==claveSucursalOrigen && estado==2){
            Ext.ComponentMgr.get("btnFinalizaPedido1").setDisabled(false);//habilitamos el boton para finalizar
            Ext.ComponentMgr.get("btnFinalizaPedido1").currentRecord=rec;
        }
    },

    onGridPedidoAfterRender: function(component, eOpts) {
        var rec = window.currentPedido.traspasos[0];

        //component.getStore().load(rec.productos);
        var arr = [];
        arr.push({"label":"Origen", "value":rec.SucursalOrigen});
        arr.push({"label":"Destino", "value":rec.SucursalDestino});
        arr.push({"label":"Numero", "value":rec.ClaveTraspaso});
        arr.push({"label":"Estado", "value":rec.estado});
        if(rec.tipoPago == 15){
            arr.push({"label":"Tipo Pago", "value":"EFECTIVO"});
        } else{
            arr.push({"label":"Tipo Pago", "value":"CREDITO"});
        }
        arr.push({"label":"Total", "value":rec.Total});
        arr.push({"label":"Fecha de Registro", "value":rec.fechaRegistro});
        arr.push({"label":"Fecha de Recepción", "value":rec.fechaRecepcion});
        arr.push({"label":"Fecha de Finalización", "value":rec.fechaFinalizacion});
        arr.push({"label":"Registrado Por", "value":rec.quienRegistra});
        arr.push({"label":"Cancelado Por", "value":rec.quienCancela});
        arr.push({"label":"Recibido Por", "value":rec.quienRecibe});
        arr.push({"label":"Finalizado Por", "value":rec.quienFinaliza});
        component.getStore().loadData(arr);


    },

    CallCancelaPedido: function(button, e, eOpts) {
        var controller =  Ext.WindowMgr.get("wndDetallePedidos").parentController;
        controller.CancelaTraspaso({"currentRecord":window.currentPedido.traspasos[0]},null,null);
    },

    RecibePedido: function(button, e, eOpts) {
        var controller =  Ext.WindowMgr.get("wndDetallePedidos").parentController;
        controller.RecibeTraspaso({"currentRecord":window.currentPedido.traspasos[0]},null,null);
    },

    FinalizaPedido: function(button, e, eOpts) {
        var controller =  Ext.WindowMgr.get("wndDetallePedidos").parentController;
        controller.FinalizaTraspasos({"currentRecord":window.currentPedido.traspasos[0]},null,null);
    }

});
