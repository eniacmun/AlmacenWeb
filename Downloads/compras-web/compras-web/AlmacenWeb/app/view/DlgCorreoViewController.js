/*
 * File: app/view/DlgCorreoViewController.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('almacen.view.DlgCorreoViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.dlgcorreo',

    onButtonClick: function(button, e, eOpts) {
        var r = Ext.create('almacen.model.mdlGeneric', {
            value: false,
            label: ''
        });

        var grid = Ext.ComponentMgr.get("gridCorreo");

        console.log("grid buscado");
        console.log(grid);

        grid.getStore().insert(0, r);

        grid.editingPlugin.startEditByPosition({row: 0, column: 0});
    },

    onButtonGuardarPedidoCorreoClick: function(button, e, eOpts) {
        var grid = Ext.ComponentMgr.get("gridCorreo");
        var store = grid.getStore();

        store.each(function(record){
            console.log(record);
        });


        var allRecords = (store.getData().getSource() || store.getData()).getRange();
        var correctRecords = [];

        console.log(allRecords);

        for(var i = 0; i < allRecords.length; i++){

            console.log(allRecords[i].get("label"));

            if(allRecords[i].get("label") !== ''){
                correctRecords.push(allRecords[i]);
            }
        }

        console.log(correctRecords);

        if(correctRecords.length === 0){
            Ext.Msg.show({
                title: 'Orden',
                message: "¿Esta seguro de no enviar ningun correo?",
                width: 600,
                cls:'productos-cls',
                buttons: Ext.Msg.OKCANCEL,
                fn: function(buttonId){
                    if (buttonId=="ok"){
                        var controller =  Ext.WindowMgr.get("wndCorreo").parentController;
                        controller.gestionaCorreos(controller, correctRecords);
                        //controller.guardaPedido(controller, correctRecords);
                        var window = Ext.ComponentMgr.get("wndCorreo");
                        window.close();
                    }
                },
                animateTarget: 'btnSavePedido',
                icon: Ext.window.MessageBox.INFO
            });
        }else{
            var controller =  Ext.WindowMgr.get("wndCorreo").parentController;
            //controller.guardaPedido(controller, correctRecords);
            controller.gestionaCorreos(controller, correctRecords);
            var window = Ext.ComponentMgr.get("wndCorreo");
            window.close();
        }


    },

    onGridCorreoAfterRender: function(component, eOpts) {
        var request = new Object();request.method="leercorreos";request.params=[];
        request.params.push({"name":"imei","value":almacen.getApplication().SessionId});

        console.log("henosaqui");
        //Ext.WindowManager.get("WndLogin").mask('Iniciando sesión, espere un momento....');

        var store = Ext.ComponentMgr.get("gridCorreo").getStore();
        almacen.getApplication().loadData(request,
        function(response){
            store.removeAll();
            console.log(response);
            store.loadData(response);
            /*for(var iter = 0; iter < response.length; iter++){
            var correo = response[0];
            console.log(correo);
            var r = Ext.create('almacen.model.mdlGeneric', {
            label: correo.label,
            value: correo.value
            });
            store.add(r);

            }*/
        }
        );
    }

});
