/*
 * File: app/view/DlgDetalleImpresion.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('almacen.view.DlgDetalleImpresion', {
    extend: 'Ext.window.Window',
    alias: 'widget.dlgdetalleimpresion',

    requires: [
        'almacen.view.DlgPedidosViewModel1',
        'almacen.view.DlgPedidosViewController1',
        'Ext.grid.Panel',
        'Ext.grid.column.Column',
        'Ext.grid.filters.filter.String',
        'Ext.panel.Tool',
        'Ext.toolbar.Toolbar',
        'Ext.toolbar.Fill',
        'Ext.button.Button',
        'Ext.grid.plugin.CellEditing',
        'Ext.grid.filters.Filters',
        'Ext.grid.feature.Summary',
        'Ext.selection.CheckboxModel'
    ],

    config: {
        currency: '£'
    },

    controller: 'dlgdetalleimpresion',
    viewModel: {
        type: 'dlgdetalleimpresion'
    },
    height: 503,
    width: 847,
    layout: 'border',
    title: 'Detalle Impresión',
    defaultListenerScope: true,

    items: [
        {
            xtype: 'gridpanel',
            region: 'center',
            id: 'gridCedis1',
            title: '',
            titleCollapse: false,
            forceFit: true,
            store: 'StoreSucursales',
            columns: [
                {
                    xtype: 'gridcolumn',
                    width: '',
                    dataIndex: 'nombreProveedor',
                    tdCls: 'x-change-cell',
                    text: 'Sucursal',
                    filter: {
                        type: 'string'
                    }
                }
            ],
            dockedItems: [
                {
                    xtype: 'panel',
                    dock: 'right',
                    autoScroll: true,
                    height: '',
                    id: 'ticketImpresion',
                    margin: 5,
                    width: 400,
                    title: 'Detalles',
                    tools: [
                        {
                            xtype: 'tool',
                            callback: function(owner, tool, event) {
                                Ext.define("plugin.Printer", {
                                    statics: {
                                        print: function(htmlElement,printAutomatically) {
                                            var win = window.open('', 'Print Panel');

                                            win.document.open();
                                            win.document.write(htmlElement.outerHTML);
                                            win.document.close();

                                            if (printAutomatically){
                                                win.print();
                                            }

                                            if (this.closeAutomaticallyAfterPrint){
                                                if(Ext.isIE){
                                                    window.close();
                                                } else {
                                                    win.close();
                                                }
                                            }
                                        }
                                    }
                                });

                                //var html = Ext.dom.Query.selectNode('#ticketImpresion-body');
                                var html = Ext.dom.Query.selectNode('#ticketImpresion-innerCt');
                                var result = html.innerHTML.trim();
                                if(result !== "" ){
                                    plugin.Printer.print(html,true);
                                }

                            },
                            type: 'print'
                        }
                    ]
                },
                {
                    xtype: 'toolbar',
                    dock: 'bottom',
                    items: [
                        {
                            xtype: 'tbfill'
                        },
                        {
                            xtype: 'button',
                            hidden: true,
                            id: 'btnWndPedidosCerrar1',
                            icon: 'resources/cancel-icon.png',
                            text: 'Cerrar Ventana'
                        },
                        {
                            xtype: 'button',
                            id: 'btnImpresionProducto',
                            icon: 'resources/Search.png',
                            text: 'Impresión por Producto',
                            listeners: {
                                click: {
                                    fn: 'onBtnImpresionProductoClick',
                                    scope: 'controller'
                                }
                            }
                        },
                        {
                            xtype: 'button',
                            id: 'btnImpresionSucursal',
                            icon: 'resources/save.png',
                            text: 'Impresión por Sucursal',
                            listeners: {
                                click: {
                                    fn: 'onBtnImpresionSucursalClick',
                                    scope: 'controller'
                                }
                            }
                        }
                    ]
                }
            ],
            plugins: [
                {
                    ptype: 'cellediting',
                    pluginId: 'onEditProductos',
                    clicksToEdit: 1
                },
                {
                    ptype: 'gridfilters'
                }
            ],
            features: [
                {
                    ftype: 'summary',
                    dock: 'bottom'
                }
            ],
            listeners: {
                beforerender: 'onGridCedis1BeforeRender'
            },
            selModel: {
                selType: 'checkboxmodel',
                mode: 'SIMPLE',
                checkOnly: true
            }
        }
    ],

    onGridCedis1BeforeRender: function(component, eOpts) {
        var back_grid = Ext.ComponentMgr.get("GridProductosCedis");

        var number_columns = window.sucursales_con_pedidos.length;
        var start_column = 5;

        var data = [];

        var record = back_grid.getStore().getData().items[0];
        var fields = record.getFields();

        //console.log("record");console.log(record);

        for (var cliente = start_column; cliente < (start_column + number_columns ); cliente ++){
            var sucursal_data = almacen.getApplication().obtenerSucursal(fields[cliente].name);
            data.push({
            nombreProveedor: sucursal_data.sucursal,
            claveProveedor: sucursal_data.clavesucursal,
            esCedi: true
            });
        }

        console.log("data");console.log(data);

        component.getStore().loadData(data);
        component.getStore().sort('nombreProveedor', 'ASC');
        component.view.refresh();
    }

});