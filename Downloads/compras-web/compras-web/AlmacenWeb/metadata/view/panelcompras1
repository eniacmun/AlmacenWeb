{
    "type": "Ext.window.Window",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "closable": false,
        "designer|userAlias": "panelcompras1",
        "designer|userClassName": "panelcompras1",
        "height": 493,
        "layout": "border",
        "maximized": true,
        "modal": true,
        "title": "Traspasos",
        "width": 649
    },
    "designerId": "b7906a6a-8dbe-404b-8e5f-dfdf2ff02960",
    "viewControllerInstanceId": "f22156a2-58bc-48ea-b055-8b19c51820a6",
    "viewModelInstanceId": "fe8f1f5a-b2fc-454f-86c2-0d63e0fb307d",
    "cn": [
        {
            "type": "Ext.form.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "bodyPadding": 10,
                "bodyStyle": [
                    "'background-color: #D9D8D8;'"
                ],
                "height": 165,
                "layout|region": "north",
                "title": "",
                "titleAlign": "center",
                "titleCollapse": true
            },
            "name": "MyForm",
            "designerId": "cb309ba1-8dfb-469b-9157-485bcddb33dd",
            "cn": [
                {
                    "type": "Ext.form.field.ComboBox",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "displayField": "nombreProveedor",
                        "fieldLabel": "Sucursal",
                        "id": "comboProveedor1",
                        "labelPad": 1,
                        "labelWidth": 80,
                        "layout|anchor": "100%",
                        "queryMode": "local",
                        "store": "StoreSucursales",
                        "valueField": "claveProveedor"
                    },
                    "name": "MyComboBox1",
                    "designerId": "914a33c5-0b74-4a47-8f07-14310fad5ca6"
                },
                {
                    "type": "Ext.form.field.ComboBox",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "allowBlank": false,
                        "displayField": "nombreproducto",
                        "fieldLabel": "Clasificaci√≥n",
                        "forceSelection": true,
                        "id": "comboClasificacion1",
                        "labelPad": 1,
                        "labelWidth": 80,
                        "layout|anchor": "100%",
                        "minChars": 2,
                        "queryMode": "local",
                        "store": "StoreClasificaciones",
                        "valueField": "clasificacion"
                    },
                    "name": "MyComboBox2",
                    "designerId": "4d746a22-e6f8-4e96-a325-bd2344e278d5"
                },
                {
                    "type": "Ext.form.field.Tag",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "allowBlank": false,
                        "displayField": "nombreproducto",
                        "fieldLabel": "Producto",
                        "id": "comboProductos1",
                        "labelPad": 1,
                        "labelWidth": 80,
                        "layout|anchor": "100%",
                        "minChars": 2,
                        "queryMode": "local",
                        "store": "StoreComboProductos",
                        "valueField": "claveproducto"
                    },
                    "name": "MyTagField",
                    "designerId": "98f912d0-152a-41b7-a5e0-eb2711225e59"
                },
                {
                    "type": "Ext.toolbar.Toolbar",
                    "reference": {
                        "name": "dockedItems",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "container|align": "stretch",
                        "container|pack": "center",
                        "dock": "bottom",
                        "style": "background-color: #141314;"
                    },
                    "name": "MyToolbar3",
                    "configAlternates": {
                        "style": "string"
                    },
                    "designerId": "750e1e93-3cb9-485b-9fa0-e7a60db0c63d",
                    "cn": [
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "icon": "resources/Search.png",
                                "id": "btnBuscarCompra1",
                                "layout|flex": null,
                                "text": "Consulta Traspasos"
                            },
                            "name": "MyButton9",
                            "designerId": "675fa837-b173-4199-9c47-4d7b8ff05356"
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "hidden": true,
                                "icon": "'http://img.informer.com/icons/png/16/5499/5499754.png'",
                                "layout|flex": null,
                                "text": "Limpiar"
                            },
                            "name": "MyButton10",
                            "designerId": "6cc6de55-87b6-45dc-aba4-401b38261c05"
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "icon": "resources/playlist.png",
                                "id": "addProductoCompra1",
                                "layout|flex": null,
                                "text": "Agregar"
                            },
                            "name": "MyButton11",
                            "designerId": "ea1f3efa-b658-4bf7-8fdd-aa6898076c21"
                        },
                        {
                            "type": "Ext.form.Label",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "id": "lblNoCompra1",
                                "layout|flex": null,
                                "text": "",
                                "width": 100
                            },
                            "name": "MyLabel",
                            "designerId": "33edaaef-79ea-4765-a538-02cc22bcf1c6"
                        }
                    ]
                }
            ]
        },
        {
            "type": "Ext.grid.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "columnLines": true,
                "designer|uiInterfaceName": "default-framed",
                "enableColumnHide": false,
                "enableColumnMove": false,
                "enableColumnResize": false,
                "forceFit": true,
                "frame": true,
                "id": "gridproductos1",
                "layout|flex": null,
                "layout|region": "center",
                "store": "StoreGridProductosTraspasos",
                "title": ""
            },
            "name": "MyGridPanel2",
            "designerId": "1fea4393-bd1b-4248-96d3-dcc1ea8f6904",
            "cn": [
                {
                    "type": "Ext.grid.column.Number",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "cantidad",
                        "text": "Cantidad",
                        "width": 70
                    },
                    "name": "MyNumberColumn2",
                    "designerId": "debae6d1-8624-432c-9203-fa1b65ac9673",
                    "cn": [
                        {
                            "type": "Ext.form.field.Number",
                            "reference": {
                                "name": "editor",
                                "type": "object"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "enableKeyEvents": true,
                                "id": "Numcantidad1",
                                "minValue": 0,
                                "selectOnFocus": true
                            },
                            "name": "MyNumberField3",
                            "designerId": "5e095e27-398e-4569-85f4-d6ace57e90d8",
                            "cn": [
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onNumcantidadAfterRender",
                                        "implHandler": [
                                            "        /*component.el.swallowEvent([",
                                            "            'keypress',",
                                            "            'keydown',",
                                            "            'keyup'",
                                            "            ]);*/",
                                            "",
                                            ""
                                        ],
                                        "name": "afterrender",
                                        "scope": "me"
                                    },
                                    "name": "onNumcantidadAfterRender",
                                    "designerId": "9ff30222-ce05-4531-bb4e-9b2743ebf202"
                                },
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onNumcantidadKeyup",
                                        "implHandler": [
                                            "if (e.getKey() == Ext.event.Event.ENTER){",
                                            "    console.log(textfield);",
                                            "}"
                                        ],
                                        "name": "keyup",
                                        "scope": "me"
                                    },
                                    "name": "onNumcantidadKeyup",
                                    "designerId": "68d9af30-bd01-486c-9dfe-afbf2435e031"
                                },
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onNumcantidadBlur",
                                        "name": "blur",
                                        "scope": "me"
                                    },
                                    "name": "onNumcantidadBlur",
                                    "designerId": "14bd4933-e4b2-472c-ad60-04a855d982ed"
                                },
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onNumcantidadFocus",
                                        "implHandler": [
                                            "component.selectText();"
                                        ],
                                        "name": "focus",
                                        "scope": "me"
                                    },
                                    "name": "onNumcantidadFocus",
                                    "designerId": "7b7ff6c1-6b70-472c-85d8-751a124bf6b0"
                                }
                            ]
                        }
                    ]
                },
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "claveproducto",
                        "text": "Clave"
                    },
                    "name": "MyColumn5",
                    "designerId": "f0942c5d-0714-4aaf-b959-aa082e201c92"
                },
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "ProporcionAplicar",
                        "defaultWidth": 78,
                        "text": "Proporcion"
                    },
                    "name": "MyColumn7",
                    "designerId": "c25152dc-3c50-4a4e-a1be-cf4a3b93607f"
                },
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "nombreproducto",
                        "defaultWidth": 304,
                        "flex": 1,
                        "text": "Descripcion"
                    },
                    "name": "MyColumn8",
                    "designerId": "ba4a1fc2-47ff-4d1c-87ef-ae80b406f7c4"
                },
                {
                    "type": "Ext.grid.column.Column",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "unidad",
                        "defaultWidth": 304,
                        "flex": 1,
                        "text": "Unidad"
                    },
                    "name": "MyColumn9",
                    "designerId": "c74d8558-5258-4c45-b417-2e9bac518871"
                },
                {
                    "type": "Ext.grid.column.Number",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "costoUnitario",
                        "text": "Precio Unitario",
                        "width": 99
                    },
                    "name": "MyNumberColumn3",
                    "designerId": "10c3c5db-a1fa-477b-86a0-946b9057b113",
                    "cn": [
                        {
                            "type": "Ext.form.field.Number",
                            "reference": {
                                "name": "editor",
                                "type": "object"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "id": "numCostoUnitario1",
                                "minValue": 0,
                                "selectOnFocus": true
                            },
                            "name": "MyNumberField4",
                            "designerId": "99c68167-6248-4770-bf53-c2bad75d4b37",
                            "cn": [
                                {
                                    "type": "basiceventbinding",
                                    "reference": {
                                        "name": "listeners",
                                        "type": "array"
                                    },
                                    "codeClass": null,
                                    "userConfig": {
                                        "fn": "onNumCostoUnitarioFocus",
                                        "implHandler": [
                                            "        component.selectText();"
                                        ],
                                        "name": "focus",
                                        "scope": "me"
                                    },
                                    "name": "onNumCostoUnitarioFocus",
                                    "designerId": "d9763227-fa46-472d-9708-1ee949dc2ed2"
                                }
                            ]
                        },
                        {
                            "type": "basicfunction",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "designer|params": [
                                    "value",
                                    "metaData",
                                    "record",
                                    "rowIndex",
                                    "colIndex",
                                    "store",
                                    "view"
                                ],
                                "fn": "renderer",
                                "implHandler": [
                                    "return Ext.util.Format.currency(value);"
                                ]
                            },
                            "name": "renderer",
                            "designerId": "714a3522-e440-42c2-bb6b-1822dcfba556"
                        }
                    ]
                },
                {
                    "type": "Ext.grid.column.Number",
                    "reference": {
                        "name": "columns",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dataIndex": "importe",
                        "id": "totalCompra",
                        "summaryType": "sum",
                        "text": "Importe Total"
                    },
                    "name": "MyNumberColumn4",
                    "configAlternates": {
                        "summaryRenderer": "object"
                    },
                    "designerId": "96baded9-0648-4305-83b3-50803c1d6e01",
                    "cn": [
                        {
                            "type": "Ext.form.field.Number",
                            "reference": {
                                "name": "editor",
                                "type": "object"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "enableKeyEvents": true,
                                "id": "numImporte1"
                            },
                            "name": "MyNumberField6",
                            "designerId": "69f061d5-32b0-4d1b-94e1-30afa3849d06"
                        },
                        {
                            "type": "basicfunction",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "designer|params": [
                                    "value",
                                    "metaData",
                                    "record",
                                    "rowIndex",
                                    "colIndex",
                                    "store",
                                    "view"
                                ],
                                "fn": "renderer",
                                "implHandler": [
                                    "return Ext.util.Format.currency(value);"
                                ]
                            },
                            "name": "renderer",
                            "designerId": "503c591b-6c5b-4548-b359-9afa02b9bb9d"
                        }
                    ]
                },
                {
                    "type": "Ext.grid.View",
                    "reference": {
                        "name": "viewConfig",
                        "type": "object"
                    },
                    "codeClass": null,
                    "name": "MyGridView2",
                    "designerId": "01ba5fb9-5a0b-4e2a-aae3-8452a5772276"
                },
                {
                    "type": "Ext.toolbar.Toolbar",
                    "reference": {
                        "name": "dockedItems",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "container|align": "stretch",
                        "container|pack": "center",
                        "designer|displayName": "toolbarGuardarCompra",
                        "dock": "bottom",
                        "height": 36,
                        "style": "background-color: #141314;"
                    },
                    "name": "MyToolbar4",
                    "configAlternates": {
                        "style": "string"
                    },
                    "designerId": "45f9d42b-8011-45a6-a808-11ce4511f381",
                    "cn": [
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "icon": "resources/back.png",
                                "id": "cancelarCompra1",
                                "layout|flex": null,
                                "text": "Regresar a Compras"
                            },
                            "name": "MyButton12",
                            "designerId": "042c5040-3351-423b-8647-e8a5f5ff2229"
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "icon": "'http://img.informer.com/icons/png/16/5499/5499754.png'",
                                "id": "cleanProductoCompra1",
                                "layout|flex": null,
                                "text": "Limpiar"
                            },
                            "name": "MyButton13",
                            "designerId": "acb30516-eed8-42c5-93b6-e745d5147249"
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "icon": "'http://worksheets.theteacherscorner.net/make-your-own/images/save.png'",
                                "id": "pagarCompra1",
                                "layout|flex": null,
                                "text": "Guardar"
                            },
                            "name": "MyButton14",
                            "designerId": "6a831c86-731f-46cf-bfb6-1f67586fbb61"
                        },
                        {
                            "type": "Ext.button.Button",
                            "reference": {
                                "name": "items",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "hidden": true,
                                "icon": "resources/print.png",
                                "id": "btnPrintCompra1",
                                "layout|flex": null,
                                "text": "Imprimir"
                            },
                            "name": "MyButton28",
                            "designerId": "3f427c30-9823-410e-9a6e-9dbcdf0c0f4a"
                        }
                    ]
                },
                {
                    "type": "Ext.toolbar.Toolbar",
                    "reference": {
                        "name": "dockedItems",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "container|align": "stretch",
                        "container|pack": "center",
                        "designer|displayName": "toolbarDescuentos",
                        "dock": "bottom",
                        "style": "background-color: #141314;"
                    },
                    "name": "MyToolbar1",
                    "configAlternates": {
                        "style": "string"
                    },
                    "designerId": "52fbab2c-7425-4a8d-8b15-d067a2b11110"
                },
                {
                    "type": "Ext.grid.plugin.CellEditing",
                    "reference": {
                        "name": "plugins",
                        "type": "array"
                    },
                    "codeClass": null,
                    "name": "MyCellEditingPlugin",
                    "designerId": "33c1bc44-c9e9-49cb-807f-b9a4eaf16606",
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onCellEditingEdit",
                                "implHandler": [
                                    "if ( this.getController(\"panelComprasViewController1\").readOnly) return false;",
                                    "if(context.colIdx===0){",
                                    "    var minimo=context.record.get(\"minimo\");",
                                    "    var maximo=context.record.get(\"maximo\");",
                                    "    if(minimo==0&&maximo==0){",
                                    "",
                                    "    }else{",
                                    "        if((context.record.get(\"cantidad\")>maximo||context.record.get(\"cantidad\")<minimo)",
                                    "           &&context.record.get(\"cantidad\")>0){",
                                    "            Ext.Msg.show({",
                                    "                title:'Confirmar',",
                                    "                message: 'La cantidad ingresada ('  + context.record.get(\"cantidad\") + ') para el producto ' +                                                                     context.record.get(\"nombreproducto\") + ' con unidad '                                                                     + context.record.get(\"unidad\") + ' es correcta?',",
                                    "                buttons: Ext.Msg.YESNO,",
                                    "                icon: Ext.Msg.QUESTION,",
                                    "                fn: function(btn) {",
                                    "                    if (btn === 'yes') {",
                                    "                        editor.getController(\"panelComprasViewController1\").calculaImportesTotales(context.record);",
                                    "                    } else if (btn === 'no') {",
                                    "                        context.record.beginEdit();",
                                    "                        context.record.set(\"cantidad\", 0);",
                                    "                        context.record.endEdit();",
                                    "                        editor.getController(\"panelComprasViewController1\").calculaImportesTotales(context.record);",
                                    "                    }",
                                    "                }",
                                    "            });",
                                    "            return;",
                                    "        }",
                                    "",
                                    "    }",
                                    "",
                                    "}",
                                    "if (context.colIdx <= 7){",
                                    "    if (context.colIdx==7){",
                                    "        if (!(context.record.get(\"Impuesto\") > \" \")){",
                                    "            context.record.beginEdit();",
                                    "            context.record.set(\"Impuesto\", 0);",
                                    "            context.record.endEdit();",
                                    "        }",
                                    "    }",
                                    "",
                                    "    ",
                                    "",
                                    "    this.getController(\"panelComprasViewController1\").calculaImportesTotales(context.record);",
                                    "}else{",
                                    "    if (context.colIdx==8){",
                                    "",
                                    "        this.getController(\"panelComprasViewController1\").CalculaImporteUnitario(context.record);",
                                    "    }",
                                    "}",
                                    ""
                                ],
                                "name": "edit",
                                "scope": "me"
                            },
                            "name": "onCellEditingEdit",
                            "designerId": "252458b0-a350-4bad-bee4-2f69dc0fb592"
                        },
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onCellEditingBeforeEdit",
                                "implHandler": [
                                    "if ( this.getController(\"panelComprasViewController\").readOnly) return false;",
                                    "",
                                    "console.log(context.colIdx);",
                                    "console.log(context.record);",
                                    "",
                                    "if (context.colIdx > 1){",
                                    "",
                                    "    if ( (context.record.get(\"cantidad\") > 0 || context.grid.columns[0].getEditor().getValue() > 0) && context.record.get(\"costoTraspaso\") === 0   ){",
                                    "    }else{",
                                    "        return false;",
                                    "",
                                    "    }",
                                    "",
                                    "}else{",
                                    "    //se trata de la columna de cantidad",
                                    "",
                                    "",
                                    "}"
                                ],
                                "name": "beforeedit",
                                "scope": "me"
                            },
                            "name": "onCellEditingBeforeEdit",
                            "designerId": "531cc033-3ca3-4266-9831-5231afff8b77"
                        }
                    ]
                },
                {
                    "type": "Ext.grid.feature.Summary",
                    "reference": {
                        "name": "features",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "dock": "bottom"
                    },
                    "name": "MySummaryFeature",
                    "designerId": "c6b49ad4-faf2-483e-8ba0-f23cb43dfcfd"
                }
            ]
        }
    ]
}